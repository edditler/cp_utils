###################################
# Variables:
#  $RUN_TYPE
#  $CHARGE
#  $CUTOFF
@SET RUN_TYPE XXX
@SET CHARGE XXX
@SET CUTOFF XXX

@SET FUNCTIONAL XXX
###################################
&GLOBAL
  PROJECT zirc
  PRINT_LEVEL MEDIUM
  RUN_TYPE $RUN_TYPE
  WALLTIME 23:50:00
&END GLOBAL
&VIBRATIONAL_ANALYSIS
  DX 0.01
  INTENSITIES
  NPROC_REP 12
  THERMOCHEMISTRY
&END VIBRATIONAL_ANALYSIS
&MOTION
  &GEO_OPT
      MAX_FORCE  0.000100
      MAX_ITER  300
      OPTIMIZER BFGS
  &END
&END MOTION
&FORCE_EVAL
  METHOD  Quickstep
  STRESS_TENSOR ANALYTICAL
  &DFT
    CHARGE $CHARGE
    BASIS_SET_FILE_NAME BASIS_MOLOPT 
    BASIS_SET_FILE_NAME BASIS_ADMM_MOLOPT
    BASIS_SET_FILE_NAME BASIS_ADMM
    POTENTIAL_FILE_NAME POTENTIAL
    UKS
    @IF $FUNCTIONAL == PBE0
    &AUXILIARY_DENSITY_MATRIX_METHOD
        METHOD BASIS_PROJECTION
        ADMM_PURIFICATION_METHOD MO_DIAG
    &END AUXILIARY_DENSITY_MATRIX_METHOD
    @ENDIF
    &MGRID
      NGRIDS 4
      CUTOFF $CUTOFF
    &END MGRID
    &QS
      EXTRAPOLATION  ASPC
      EXTRAPOLATION_ORDER  3
      METHOD  GPW
      @IF $FUNCTIONAL == PBE0
      EPS_PGF_ORB 1.0E-100
      @ENDIF
    &END QS
    &SCF
      SCF_GUESS        RESTART
      EPS_SCF          1.0E-6
      MAX_SCF          30
      &OT
        MINIMIZER  CG
        PRECONDITIONER  FULL_SINGLE_INVERSE
      &END OT
      &OUTER_SCF
        EPS_SCF  1.0E-6
        MAX_SCF  25
      &END OUTER_SCF
      &PRINT
        &RESTART
          ADD_LAST  NUMERIC
          &EACH
            QS_SCF  20
          &END EACH
          FILENAME  RESTART
        &END RESTART
      &END PRINT
    &END SCF
    &PRINT
      &MOMENTS
        REFERENCE COM
      &END
    &END
    &XC
      @IF $FUNCTIONAL == PBE0
      &HF
        &SCREENING
          EPS_SCHWARZ 1.0E-10
        &END SCREENING
        &INTERACTION_POTENTIAL
          POTENTIAL_TYPE TRUNCATED
          CUTOFF_RADIUS 10  # about half of the shortest unit cell edge
          T_C_G_DATA t_c_g.dat
        &END INTERACTION_POTENTIAL
      &END HF
      @ENDIF
      &XC_FUNCTIONAL $FUNCTIONAL
      &END
      &vdW_POTENTIAL 
        POTENTIAL_TYPE PAIR_POTENTIAL
        &PAIR_POTENTIAL 
          TYPE DFTD3
          PARAMETER_FILE_NAME dftd3.dat
          REFERENCE_FUNCTIONAL $FUNCTIONAL
        &END PAIR_POTENTIAL
      &END vdW_POTENTIAL 
    &END XC 
  &END DFT
  &SUBSYS
    &TOPOLOGY
      COORD_FILE_FORMAT xyz
      COORD_FILE_NAME coords.xyz
      &CENTER_COORDINATES
      &END CENTER_COORDINATES
    &END TOPOLOGY
    &CELL
      ABC 27.01029138 27.01029138 27.01029138 
      SYMMETRY CUBIC
    &END CELL
    &KIND Zr
      BASIS_SET DZVP-MOLOPT-SR-GTH
      POTENTIAL GTH-PBE
      @IF $FUNCTIONAL == PBE0
      BASIS_SET AUX_FIT FIT11
      @ENDIF
    &END KIND
    &KIND O
      BASIS_SET DZVP-MOLOPT-SR-GTH
      POTENTIAL GTH-PBE
      @IF $FUNCTIONAL == PBE0
      BASIS_SET AUX_FIT FIT9
      @ENDIF
    &END KIND
    &KIND Co
      BASIS_SET DZVP-MOLOPT-SR-GTH
      POTENTIAL GTH-PBE
      @IF $FUNCTIONAL == PBE0
      BASIS_SET AUX_FIT FIT11
      @ENDIF
    &END KIND
    &KIND P
      BASIS_SET DZVP-MOLOPT-SR-GTH
      POTENTIAL GTH-PBE
      @IF $FUNCTIONAL == PBE0
      BASIS_SET AUX_FIT aug-pFIT3
      @ENDIF
    &END KIND
    &KIND N
      BASIS_SET DZVP-MOLOPT-SR-GTH
      POTENTIAL GTH-PBE
      @IF $FUNCTIONAL == PBE0
      BASIS_SET AUX_FIT aug-pFIT3
      @ENDIF
    &END KIND
    &KIND C
      BASIS_SET DZVP-MOLOPT-SR-GTH
      POTENTIAL GTH-PBE
      @IF $FUNCTIONAL == PBE0
      BASIS_SET AUX_FIT aug-pFIT3
      @ENDIF
    &END KIND
    &KIND H
      BASIS_SET DZVP-MOLOPT-SR-GTH
      POTENTIAL GTH-PBE
      @IF $FUNCTIONAL == PBE0
      BASIS_SET AUX_FIT aug-pFIT3
      @ENDIF
    &END KIND
  &END SUBSYS
&END FORCE_EVAL
